
/**
 * 由 admin 提供技术支持
 * Powered by admin
 * 代码仓库
 * Github https://github.com/Lmx1220/kpu-web
 */
    
import{bf as X,u as Y,W as K,r as U,c as $,z as R,K as J}from"./bootstrap-DTzpk8a9.js";/*!
 * watermark-js-plus v1.5.8
 * (c) 2022-2024 Michael Sun
 * Released under the MIT License.
 */function Q(r,t){t===void 0&&(t={});var i=t.insertAt;if(!(typeof document>"u")){var a=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css",i==="top"&&a.firstChild?a.insertBefore(e,a.firstChild):a.appendChild(e),e.styleSheet?e.styleSheet.cssText=r:e.appendChild(document.createTextNode(r))}}var Z="@keyframes watermark{0%{background-position:0 0}25%{background-position:100% 100%}50%{background-position:0 0}75%{background-position:100% -100%}to{background-position:0 0}}";Q(Z);var I=function(r,t){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,a){i.__proto__=a}||function(i,a){for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(i[e]=a[e])},I(r,t)};function tt(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");I(r,t);function i(){this.constructor=r}r.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var k=function(){return k=Object.assign||function(t){for(var i,a=1,e=arguments.length;a<e;a++){i=arguments[a];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},k.apply(this,arguments)};function S(r,t,i,a){function e(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function l(c){try{s(a.next(c))}catch(h){o(h)}}function d(c){try{s(a.throw(c))}catch(h){o(h)}}function s(c){c.done?n(c.value):e(c.value).then(l,d)}s((a=a.apply(r,t||[])).next())})}function b(r,t){var i={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},a,e,n,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(s){return function(c){return d([s,c])}}function d(s){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(a=1,e&&(n=s[0]&2?e.return:s[0]?e.throw||((n=e.return)&&n.call(e),0):e.next)&&!(n=n.call(e,s[1])).done)return n;switch(e=0,n&&(s=[s[0]&2,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,e=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(n=i.trys,!(n=n.length>0&&n[n.length-1])&&(s[0]===6||s[0]===2)){i=0;continue}if(s[0]===3&&(!n||s[1]>n[0]&&s[1]<n[3])){i.label=s[1];break}if(s[0]===6&&i.label<n[1]){i.label=n[1],n=s;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(s);break}n[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(r,i)}catch(c){s=[6,c],e=0}finally{a=n=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}var V=function(r){return r.toDataURL("image/png",1)},N=function(r){return typeof r=="function"},x=function(r){return r===void 0},et=function(r){return typeof r=="string"},z=function(r,t,i){t===void 0&&(t={}),i===void 0&&(i="http://www.w3.org/2000/svg");var a=document.createElementNS(i,r);for(var e in t)a.setAttribute(e,t[e]);return a},it=function(r,t,i){for(var a=[],e="",n="",o=0,l=t.length;o<l;o++){if(n=t.charAt(o),n===`
`){a.push(e),e="";continue}e+=n,r.measureText(e).width>i&&(a.push(e.substring(0,e.length-1)),e="",o--)}return a.push(e),a},at=function(r,t){return S(void 0,void 0,void 0,function(){var i,a,e,n,o,l,d,s,c;return b(this,function(h){switch(h.label){case 0:return i=z("svg",{xmlns:"http://www.w3.org/2000/svg"}),a=document.createElement("div"),a.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),a.style.cssText=`
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  font: `.concat(r.font,`;
  color: `).concat(t.fontColor,`;
`),a.innerHTML="<div class='rich-text-content'>".concat(t.content,"</div>"),document.body.appendChild(a),[4,nt(a)];case 1:return h.sent(),e=(c=a.querySelector(".rich-text-content"))===null||c===void 0?void 0:c.getBoundingClientRect(),n=e==null?void 0:e.width,o=e==null?void 0:e.height,document.body.removeChild(a),l=t.richTextWidth||n||t.width,d=t.richTextHeight||o||t.height,i.setAttribute("width",l.toString()),i.setAttribute("height",d.toString()),s=z("foreignObject",{width:l.toString(),height:d.toString()}),s.appendChild(a),i.appendChild(s),[2,{element:i,width:l,height:d}]}})})};function nt(r){return S(this,void 0,void 0,function(){var t,i,a,e,n;return b(this,function(o){switch(o.label){case 0:t=r.querySelectorAll("img"),i=function(l){var d,s,c,h,v;return b(this,function(u){switch(u.label){case 0:if(d=l.getAttribute("src"),!d)return[3,6];u.label=1;case 1:return u.trys.push([1,5,,6]),[4,fetch(d)];case 2:return s=u.sent(),[4,s.blob()];case 3:return c=u.sent(),[4,new Promise(function(m,p){var f=new FileReader;f.onloadend=function(){return m(f.result)},f.onerror=p,f.readAsDataURL(c)})];case 4:return h=u.sent(),et(h)&&l.setAttribute("src",h),[3,6];case 5:return v=u.sent(),console.error("Error converting ".concat(d," to base64:"),v),[3,6];case 6:return[2]}})},a=0,e=Array.from(t),o.label=1;case 1:return a<e.length?(n=e[a],[5,i(n)]):[3,4];case 2:o.sent(),o.label=3;case 3:return a++,[3,1];case 4:return[2]}})})}var rt=function(r){var t=r.outerHTML.replace(/<(img|br|input|hr|embed)(.*?)>/g,"<$1$2/>").replace(/\n/g,"").replace(/\t/g,"").replace(/#/g,"%23");return"data:image/svg+xml;charset=utf-8,".concat(t)},y=function(r,t){return x(r)?t:r},G=function(r,t,i){t===void 0&&(t=void 0),i===void 0&&(i=void 0);var a=new Image;return a.setAttribute("crossOrigin","Anonymous"),!x(t)&&(a.width=t),!x(i)&&(a.height=i),a.src=r,new Promise(function(e){a.onload=function(){e(a)}})},ot=function(r,t,i){return Array.from({length:r},function(){return new Array(t).fill(i)})},q={width:300,height:300,rotate:45,layout:"default",auxiliaryLine:!1,translatePlacement:"middle",contentType:"text",content:"hello watermark-js-plus",textType:"fill",imageWidth:0,imageHeight:0,lineHeight:30,zIndex:2147483647,backgroundPosition:"0 0",backgroundRepeat:"repeat",fontSize:"20px",fontFamily:"sans-serif",fontStyle:"",fontVariant:"",fontColor:"#000",fontWeight:"normal",filter:"none",letterSpacing:"0px",wordSpacing:"0px",globalAlpha:.5,mode:"default",mutationObserve:!0,monitorProtection:!1,movable:!1,parent:"body",onSuccess:function(){},onBeforeDestroy:function(){},onDestroyed:function(){},onObserveError:function(){}},lt=function(r,t,i){var a=r.getContext("2d");if(a===null)throw new Error("get context error");a.font="".concat(t.fontStyle," ").concat(t.fontVariant," ").concat(t.fontWeight," ").concat(t.fontSize," ").concat(t.fontFamily),a.filter=t.filter,a.letterSpacing=t.letterSpacing,a.wordSpacing=t.wordSpacing,t!=null&&t.rotate&&(t.rotate=(360-t.rotate%360)*(Math.PI/180)),x(i.textRowMaxWidth)&&(t.textRowMaxWidth=t.width);var e={image:{rect:{width:t.imageWidth,height:t.imageHeight},position:{x:0,y:0}},textLine:{data:[],yOffsetValue:0},advancedStyleParams:{linear:{x0:0,x1:0},radial:{x0:0,y0:0,r0:0,x1:0,y1:0,r1:0},conic:{x:0,y:0,startAngle:0},pattern:{}}};switch(t.contentType){case"text":e.textLine.data=[t.content];break;case"multi-line-text":e.textLine.data=it(a,t.content,t.textRowMaxWidth);break}var n=t.width/2,o=t.height/2,l="middle",d="center";switch(!x(i==null?void 0:i.translateX)&&!x(i==null?void 0:i.translateY)?(n=i==null?void 0:i.translateX,o=i==null?void 0:i.translateY,l="top",d="left"):(e.advancedStyleParams.linear.x0=-t.width/2,e.advancedStyleParams.linear.x1=t.width/2,e.advancedStyleParams.radial.r0=0,e.advancedStyleParams.radial.r1=t.width/2),i.translatePlacement){case"top":n=t.width/2,o=0,l="top",e.advancedStyleParams.linear.x0=-t.width/2,e.advancedStyleParams.linear.x1=t.width/2,e.advancedStyleParams.radial.y0=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.y1=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.y=e.textLine.data.length*t.lineHeight/2;break;case"top-start":n=0,o=0,l="top",d="start",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=t.width,e.advancedStyleParams.radial.x0=t.width/2,e.advancedStyleParams.radial.y0=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.x1=t.width/2,e.advancedStyleParams.radial.y1=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=t.width/2,e.advancedStyleParams.conic.y=e.textLine.data.length*t.lineHeight/2;break;case"top-end":n=t.width,o=0,l="top",d="end",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=-t.width,e.advancedStyleParams.radial.x0=-t.width/2,e.advancedStyleParams.radial.y0=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.x1=-t.width/2,e.advancedStyleParams.radial.y1=e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=-t.width/2,e.advancedStyleParams.conic.y=e.textLine.data.length*t.lineHeight/2;break;case"bottom":n=t.width/2,o=t.height,l="bottom",e.advancedStyleParams.linear.x0=-t.width/2,e.advancedStyleParams.linear.x1=t.width/2,e.advancedStyleParams.radial.y0=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.y1=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=0,e.advancedStyleParams.conic.y=-e.textLine.data.length*t.lineHeight/2;break;case"bottom-start":n=0,o=t.height,l="bottom",d="start",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=t.width,e.advancedStyleParams.radial.x0=t.width/2,e.advancedStyleParams.radial.y0=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.x1=t.width/2,e.advancedStyleParams.radial.y1=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=t.width/2,e.advancedStyleParams.conic.y=-e.textLine.data.length*t.lineHeight/2;break;case"bottom-end":n=t.width,o=t.height,l="bottom",d="end",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=-t.width,e.advancedStyleParams.radial.x0=-t.width/2,e.advancedStyleParams.radial.y0=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.radial.x1=-t.width/2,e.advancedStyleParams.radial.y1=-e.textLine.data.length*t.lineHeight/2,e.advancedStyleParams.conic.x=-t.width/2,e.advancedStyleParams.conic.y=-e.textLine.data.length*t.lineHeight/2;break;case"left":n=0,o=t.height/2,d="start",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=t.width,e.advancedStyleParams.radial.x0=t.width/2,e.advancedStyleParams.radial.x1=t.width/2,e.advancedStyleParams.conic.x=t.width/2,e.advancedStyleParams.conic.y=0;break;case"right":n=t.width,o=t.height/2,d="end",e.advancedStyleParams.linear.x0=0,e.advancedStyleParams.linear.x1=-t.width,e.advancedStyleParams.radial.x0=-t.width/2,e.advancedStyleParams.radial.x1=-t.width/2,e.advancedStyleParams.conic.x=-t.width/2,e.advancedStyleParams.conic.y=0;break}if(t.translateX=n,t.translateY=o,x(i==null?void 0:i.textBaseline)&&(t.textBaseline=l),x(i==null?void 0:i.textAlign)&&(t.textAlign=d),["text","multi-line-text"].includes(t.contentType))switch(t.textBaseline){case"middle":e.textLine.yOffsetValue=(e.textLine.data.length-1)*t.lineHeight/2;break;case"bottom":case"alphabetic":case"ideographic":e.textLine.yOffsetValue=(e.textLine.data.length-1)*t.lineHeight+(t.lineHeight-parseInt(t.fontSize))/2;break;case"top":case"hanging":e.textLine.yOffsetValue=-t.lineHeight/2+parseInt(t.fontSize)/2;break}return e},j=function(r){typeof window>"u"||r&&(Object.defineProperty(window,"MutationObserver",{writable:!1,configurable:!1}),Object.defineProperty(window,"requestAnimationFrame",{writable:!1,configurable:!1}))},C=function(){function r(t,i){this.props=t,this.options=i,this.canvas=r.createCanvas(this.options.width,this.options.height),this.recommendOptions=lt(this.canvas,this.options,this.props)}return r.createCanvas=function(t,i){var a,e=window.devicePixelRatio||1,n=document.createElement("canvas");return n.width=t*e,n.height=i*e,n.style.width="".concat(t,"px"),n.style.height="".concat(i,"px"),(a=n.getContext("2d"))===null||a===void 0||a.setTransform(e,0,0,e,0,0),n},r.clearCanvas=function(t){var i=t.getContext("2d");if(i===null)throw new Error("get context error");i.restore(),i.resetTransform(),i.clearRect(0,0,t.width,t.height);var a=window.devicePixelRatio||1;i.setTransform(a,0,0,a,0,0)},r.prototype.getCanvas=function(){return this.canvas},r.prototype.clear=function(){r.clearCanvas(this.canvas)},r.prototype.draw=function(){var t=this,i=this.canvas.getContext("2d");if(i===null)throw new Error("get context error");return this.options.auxiliaryLine&&(i.beginPath(),i.rect(0,0,this.options.width,this.options.height),i.lineWidth=1,i.strokeStyle="#000",i.stroke(),i.closePath(),i.beginPath(),i.rect(this.options.translateX,this.options.translateY,1,1),i.lineWidth=1,i.strokeStyle="#f00",i.stroke(),i.closePath()),this.setStyle(i),i.save(),i.translate(this.options.translateX,this.options.translateY),i.rotate(this.options.rotate),new Promise(function(a){switch(t.options.contentType){case"text":t.drawText(i,a);break;case"image":t.drawImage(i,a);break;case"multi-line-text":t.drawMultiLineText(i,a);break;case"rich-text":t.drawRichText(i,a);break}})},r.prototype.setStyle=function(t){var i,a="fillStyle";this.options.textType==="stroke"&&(a="strokeStyle");var e=this.options.fontColor;if(!((i=this.options)===null||i===void 0)&&i.advancedStyle)switch(this.options.advancedStyle.type){case"linear":e=this.createLinearGradient(t);break;case"radial":e=this.createRadialGradient(t);break;case"conic":e=this.createConicGradient(t);break;case"pattern":e=this.createPattern(t);break}t[a]&&e&&(t[a]=e),this.options.textAlign&&(t.textAlign=this.options.textAlign),this.options.textBaseline&&(t.textBaseline=this.options.textBaseline),t.globalAlpha=this.options.globalAlpha,this.options.shadowStyle&&(t.shadowBlur=y(this.options.shadowStyle.shadowBlur,0),t.shadowColor=y(this.options.shadowStyle.shadowColor,"#00000000"),t.shadowOffsetX=y(this.options.shadowStyle.shadowOffsetX,0),t.shadowOffsetY=y(this.options.shadowStyle.shadowOffsetY,0)),N(this.options.extraDrawFunc)&&this.options.extraDrawFunc(t)},r.prototype.createLinearGradient=function(t){var i,a,e,n,o,l,d,s,c,h,v,u,m,p,f,w=t.createLinearGradient(y((e=(a=(i=this.options.advancedStyle)===null||i===void 0?void 0:i.params)===null||a===void 0?void 0:a.linear)===null||e===void 0?void 0:e.x0,this.recommendOptions.advancedStyleParams.linear.x0),y((l=(o=(n=this.options.advancedStyle)===null||n===void 0?void 0:n.params)===null||o===void 0?void 0:o.linear)===null||l===void 0?void 0:l.y0,0),y((c=(s=(d=this.options.advancedStyle)===null||d===void 0?void 0:d.params)===null||s===void 0?void 0:s.linear)===null||c===void 0?void 0:c.x1,this.recommendOptions.advancedStyleParams.linear.x1),y((u=(v=(h=this.options.advancedStyle)===null||h===void 0?void 0:h.params)===null||v===void 0?void 0:v.linear)===null||u===void 0?void 0:u.y1,0));return(f=(p=(m=this.options)===null||m===void 0?void 0:m.advancedStyle)===null||p===void 0?void 0:p.colorStops)===null||f===void 0||f.forEach(function(g){w.addColorStop(g.offset,g.color)}),w},r.prototype.createConicGradient=function(t){var i,a,e,n,o,l,d,s,c,h,v,u,m,p,f,w=t.createConicGradient(y((n=(e=(a=(i=this.options)===null||i===void 0?void 0:i.advancedStyle)===null||a===void 0?void 0:a.params)===null||e===void 0?void 0:e.conic)===null||n===void 0?void 0:n.startAngle,0),y((s=(d=(l=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||l===void 0?void 0:l.params)===null||d===void 0?void 0:d.conic)===null||s===void 0?void 0:s.x,this.recommendOptions.advancedStyleParams.conic.x),y((u=(v=(h=(c=this.options)===null||c===void 0?void 0:c.advancedStyle)===null||h===void 0?void 0:h.params)===null||v===void 0?void 0:v.conic)===null||u===void 0?void 0:u.y,this.recommendOptions.advancedStyleParams.conic.y));return(f=(p=(m=this.options)===null||m===void 0?void 0:m.advancedStyle)===null||p===void 0?void 0:p.colorStops)===null||f===void 0||f.forEach(function(g){w.addColorStop(g.offset,g.color)}),w},r.prototype.createRadialGradient=function(t){var i,a,e,n,o,l,d,s,c,h,v,u,m,p,f,w,g,_,P,O,E,L,T,A,W,D,H,M=t.createRadialGradient(y((n=(e=(a=(i=this.options)===null||i===void 0?void 0:i.advancedStyle)===null||a===void 0?void 0:a.params)===null||e===void 0?void 0:e.radial)===null||n===void 0?void 0:n.x0,this.recommendOptions.advancedStyleParams.radial.x0),y((s=(d=(l=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||l===void 0?void 0:l.params)===null||d===void 0?void 0:d.radial)===null||s===void 0?void 0:s.y0,this.recommendOptions.advancedStyleParams.radial.y0),y((u=(v=(h=(c=this.options)===null||c===void 0?void 0:c.advancedStyle)===null||h===void 0?void 0:h.params)===null||v===void 0?void 0:v.radial)===null||u===void 0?void 0:u.r0,this.recommendOptions.advancedStyleParams.radial.r0),y((w=(f=(p=(m=this.options)===null||m===void 0?void 0:m.advancedStyle)===null||p===void 0?void 0:p.params)===null||f===void 0?void 0:f.radial)===null||w===void 0?void 0:w.x1,this.recommendOptions.advancedStyleParams.radial.x1),y((O=(P=(_=(g=this.options)===null||g===void 0?void 0:g.advancedStyle)===null||_===void 0?void 0:_.params)===null||P===void 0?void 0:P.radial)===null||O===void 0?void 0:O.y1,this.recommendOptions.advancedStyleParams.radial.y1),y((A=(T=(L=(E=this.options)===null||E===void 0?void 0:E.advancedStyle)===null||L===void 0?void 0:L.params)===null||T===void 0?void 0:T.radial)===null||A===void 0?void 0:A.r1,this.recommendOptions.advancedStyleParams.radial.r1));return(H=(D=(W=this.options)===null||W===void 0?void 0:W.advancedStyle)===null||D===void 0?void 0:D.colorStops)===null||H===void 0||H.forEach(function(B){M.addColorStop(B.offset,B.color)}),M},r.prototype.createPattern=function(t){var i,a,e,n,o,l,d,s;return t.createPattern((n=(e=(a=(i=this.options)===null||i===void 0?void 0:i.advancedStyle)===null||a===void 0?void 0:a.params)===null||e===void 0?void 0:e.pattern)===null||n===void 0?void 0:n.image,((s=(d=(l=(o=this.options)===null||o===void 0?void 0:o.advancedStyle)===null||l===void 0?void 0:l.params)===null||d===void 0?void 0:d.pattern)===null||s===void 0?void 0:s.repetition)||"")},r.prototype.setText=function(t,i){var a="fillText";this.options.textType==="stroke"&&(a="strokeText"),t[a]&&t[a](i.text,i.x,i.y,i.maxWidth)},r.prototype.drawText=function(t,i){this.setText(t,{text:this.options.content,x:0,y:0-this.recommendOptions.textLine.yOffsetValue,maxWidth:this.options.textRowMaxWidth||this.options.width}),i(t.canvas)},r.prototype.drawImage=function(t,i){var a=this;G(this.options.image).then(function(e){var n=a.getImageRect(e),o=n.width,l=n.height,d=a.getDrawImagePosition(o,l);t.drawImage(e,d.x,d.y,o,l),i(t.canvas)})},r.prototype.drawMultiLineText=function(t,i){var a=this,e=this.recommendOptions.textLine.data,n=this.recommendOptions.textLine.yOffsetValue;e.forEach(function(o,l){a.setText(t,{text:o,x:0,y:a.options.lineHeight*l-n,maxWidth:a.options.textRowMaxWidth||a.options.width})}),i(t.canvas)},r.prototype.drawRichText=function(t,i){return S(this,void 0,void 0,function(){var a,e=this;return b(this,function(n){switch(n.label){case 0:return[4,at(t,this.options)];case 1:return a=n.sent(),G(rt(a.element),a.width,a.height).then(function(o){var l=e.getDrawImagePosition(o.width,o.height);t.drawImage(o,l.x,l.y,o.width,o.height),i(t.canvas)}),[2]}})})},r.prototype.getImageRect=function(t){var i={width:this.options.imageWidth||0,height:this.options.imageHeight||0};switch(!0){case(i.width!==0&&i.height===0):i.height=i.width*t.height/t.width;break;case(i.width===0&&i.height!==0):i.width=i.height*t.width/t.height;break;case(i.width===0&&i.height===0):i.width=t.width,i.height=t.height;break}return i},r.prototype.getDrawImagePosition=function(t,i){var a,e,n={x:-t/2,y:-i/2};switch(this.options.translatePlacement){case"top":n.x=-t/2,n.y=0;break;case"top-start":n.x=0,n.y=0;break;case"top-end":n.x=-t,n.y=0;break;case"bottom":n.x=-t/2,n.y=-i;break;case"bottom-start":n.x=0,n.y=-i;break;case"bottom-end":n.x=-t,n.y=-i;break;case"left":n.x=0,n.y=-i/2;break;case"right":n.x=-t,n.y=-i/2;break}return!x((a=this.props)===null||a===void 0?void 0:a.translateX)&&(n.x=0),!x((e=this.props)===null||e===void 0?void 0:e.translateY)&&(n.y=0),n},r}(),st=function(){function r(t,i){var a,e,n,o;this.options=t,this.partialWidth=this.options.width,this.partialHeight=this.options.height,this.rows=((a=this.options.gridLayoutOptions)===null||a===void 0?void 0:a.rows)||1,this.cols=((e=this.options.gridLayoutOptions)===null||e===void 0?void 0:e.cols)||1,this.matrix=((n=this.options.gridLayoutOptions)===null||n===void 0?void 0:n.matrix)||ot(this.rows,this.cols,1),this.gap=((o=this.options.gridLayoutOptions)===null||o===void 0?void 0:o.gap)||[0,0],this.partialCanvas=i}return r.prototype.draw=function(){var t,i,a,e,n,o,l,d,s=C.createCanvas(((t=this.options.gridLayoutOptions)===null||t===void 0?void 0:t.width)||this.partialWidth*this.cols+this.gap[0]*this.cols,((i=this.options.gridLayoutOptions)===null||i===void 0?void 0:i.height)||this.partialHeight*this.rows+this.gap[1]*this.rows),c=s.getContext("2d");!((a=this.options.gridLayoutOptions)===null||a===void 0)&&a.backgroundImage&&(c==null||c.drawImage((e=this.options.gridLayoutOptions)===null||e===void 0?void 0:e.backgroundImage,0,0,(n=this.options.gridLayoutOptions)===null||n===void 0?void 0:n.width,(o=this.options.gridLayoutOptions)===null||o===void 0?void 0:o.height));for(var h=0;h<this.rows;h++)for(var v=0;v<this.cols;v++)!((d=(l=this.matrix)===null||l===void 0?void 0:l[h])===null||d===void 0)&&d[v]&&(c==null||c.drawImage(this.partialCanvas,this.partialWidth*v+this.gap[0]*v,this.partialHeight*h+this.gap[1]*h,this.partialWidth,this.partialHeight));return s},r}(),dt=function(r,t){switch(r.layout){case"grid":return new st(r,t).draw();default:return t}},ct=function(r){var t,i,a;switch(r.layout){case"grid":{var e=((t=r.gridLayoutOptions)===null||t===void 0?void 0:t.cols)||1,n=((i=r.gridLayoutOptions)===null||i===void 0?void 0:i.rows)||1,o=((a=r.gridLayoutOptions)===null||a===void 0?void 0:a.gap)||[0,0];return[r.width*e+o[0]*e,r.height*n+o[1]*n]}default:return[r.width,r.height]}},F=function(){function r(t){t===void 0&&(t={}),this.parentElement=document.body,this.isCreating=!1,this.props=t,this.options=k(k({},q),t),this.changeParentElement(this.options.parent),this.watermarkCanvas=new C(this.props,this.options),j(this.options.monitorProtection)}return r.prototype.changeOptions=function(){return S(this,arguments,void 0,function(t,i,a){return t===void 0&&(t={}),i===void 0&&(i="overwrite"),a===void 0&&(a=!0),b(this,function(e){switch(e.label){case 0:return this.initConfigData(t,i),j(this.options.monitorProtection),a?(this.remove(),[4,this.create()]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},r.prototype.create=function(){return S(this,void 0,void 0,function(){var t,i,a,e,n,o,l,d,s,c,h,v;return b(this,function(u){switch(u.label){case 0:return this.isCreating?[2]:(this.isCreating=!0,this.validateUnique()?this.validateContent()?(t=x(this.watermarkDom),[4,(o=this.watermarkCanvas)===null||o===void 0?void 0:o.draw()]):(this.isCreating=!1,[2]):(this.isCreating=!1,[2]));case 1:if(u.sent(),this.layoutCanvas=dt(this.options,(l=this.watermarkCanvas)===null||l===void 0?void 0:l.getCanvas()),i=V(this.layoutCanvas),(d=this.watermarkCanvas)===null||d===void 0||d.clear(),this.watermarkDom=document.createElement("div"),a=document.createElement("div"),this.watermarkDom.__WATERMARK__="watermark",this.watermarkDom.__WATERMARK__INSTANCE__=this,e=this.checkParentElementType(),this.watermarkDom.style.cssText=`
      z-index:`.concat(this.options.zIndex,`!important;display:block!important;visibility:visible!important;transform:none!important;scale:none!important;
      `).concat(e==="custom"?"top:0!important;bottom:0!important;left:0!important;right:0!important;height:100%!important;pointer-events:none!important;position:absolute!important;":"position:relative!important;",`
    `),n=ct(this.options),a.style.cssText=`
      display:block!important;visibility:visible!important;pointer-events:none;top:0;bottom:0;left:0;right:0;transform:none!important;scale:none!important;
      position:`.concat(e==="root"?"fixed":"absolute",`!important;-webkit-print-color-adjust:exact!important;width:100%!important;height:100%!important;
      z-index:`).concat(this.options.zIndex,"!important;background-image:url(").concat(i,")!important;background-repeat:").concat(this.options.backgroundRepeat,`!important;
      background-size:`).concat(n[0],"px ").concat(n[1],"px!important;background-position:").concat(this.options.backgroundPosition,`;
      `).concat(this.options.movable?"animation: 200s ease 0s infinite normal none running watermark !important;":"",`
    `),this.watermarkDom.appendChild(a),this.parentElement.appendChild(this.watermarkDom),this.options.mutationObserve)try{this.bindMutationObserve()}catch{(c=(s=this.options).onObserveError)===null||c===void 0||c.call(s)}return t&&((v=(h=this.options).onSuccess)===null||v===void 0||v.call(h)),this.isCreating=!1,[2]}})})},r.prototype.destroy=function(){this.remove(),this.watermarkDom=void 0},r.prototype.check=function(){return S(this,void 0,void 0,function(){return b(this,function(t){return[2,this.parentElement.contains(this.watermarkDom)]})})},r.prototype.remove=function(){var t,i,a,e,n,o,l,d;(i=(t=this.options).onBeforeDestroy)===null||i===void 0||i.call(t),(a=this.observer)===null||a===void 0||a.disconnect(),(e=this.parentObserve)===null||e===void 0||e.disconnect(),this.unbindCheckWatermarkElementEvent(),(o=(n=this.watermarkDom)===null||n===void 0?void 0:n.parentNode)===null||o===void 0||o.removeChild(this.watermarkDom),(d=(l=this.options).onDestroyed)===null||d===void 0||d.call(l)},r.prototype.initConfigData=function(t,i){var a=this;i===void 0&&(i="overwrite"),i==="append"?Object.keys(t).forEach(function(e){a.props&&(a.props[e]=t[e])}):this.props=t,this.options=k(k({},q),this.props),this.changeParentElement(this.options.parent),this.watermarkCanvas=new C(this.props,this.options)},r.prototype.changeParentElement=function(t){if(typeof t=="string"){var i=document.querySelector(t);i&&(this.parentElement=i)}else this.parentElement=t;this.parentElement||console.error("[WatermarkJsPlus]: please pass a valid parent element.")},r.prototype.validateUnique=function(){var t=!0;return Array.from(this.parentElement.childNodes).forEach(function(i){t&&Object.hasOwnProperty.call(i,"__WATERMARK__")&&(t=!1)}),t},r.prototype.validateContent=function(){switch(this.options.contentType){case"image":return Object.hasOwnProperty.call(this.options,"image");case"multi-line-text":case"rich-text":case"text":return this.options.content.length>0}},r.prototype.checkParentElementType=function(){return["html","body"].includes(this.parentElement.tagName.toLocaleLowerCase())?"root":"custom"},r.prototype.checkWatermarkElement=function(){return S(this,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return this.parentElement.contains(this.watermarkDom)?[3,2]:(this.remove(),[4,this.create()]);case 1:t.sent(),t.label=2;case 2:return this.bindCheckWatermarkElementEvent(),[2]}})})},r.prototype.bindMutationObserve=function(){var t=this;this.watermarkDom&&(this.bindCheckWatermarkElementEvent(),this.observer=new MutationObserver(function(i){return S(t,void 0,void 0,function(){return b(this,function(a){switch(a.label){case 0:return i.length>0?(this.remove(),[4,this.create()]):[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}})})}),this.observer.observe(this.watermarkDom,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),this.parentObserve=new MutationObserver(function(i){return S(t,void 0,void 0,function(){var a,e,n,o;return b(this,function(l){switch(l.label){case 0:a=0,e=i,l.label=1;case 1:return a<e.length?(n=e[a],(n==null?void 0:n.target)===this.watermarkDom||((o=n==null?void 0:n.removedNodes)===null||o===void 0?void 0:o[0])===this.watermarkDom||n.type==="childList"&&n.target===this.parentElement&&n.target.lastChild!==this.watermarkDom?(this.remove(),[4,this.create()]):[3,3]):[3,4];case 2:l.sent(),l.label=3;case 3:return a++,[3,1];case 4:return[2]}})})}),this.parentObserve.observe(this.parentElement,{attributes:!0,childList:!0,subtree:!0,characterData:!0}))},r.prototype.bindCheckWatermarkElementEvent=function(){this.unbindCheckWatermarkElementEvent(),this.checkWatermarkElementRequestID=requestAnimationFrame(this.checkWatermarkElement.bind(this))},r.prototype.unbindCheckWatermarkElementEvent=function(){x(this.checkWatermarkElementRequestID)||cancelAnimationFrame(this.checkWatermarkElementRequestID)},r}();(function(r){tt(t,r);function t(i){i===void 0&&(i={});var a={globalAlpha:.005,mode:"blind"};return r.call(this,k(k({},i),a))||this}return t.prototype.changeOptions=function(){return S(this,arguments,void 0,function(i,a,e){return i===void 0&&(i={}),a===void 0&&(a="overwrite"),e===void 0&&(e=!0),b(this,function(n){switch(n.label){case 0:return i.globalAlpha=.005,i.mode="blind",this.initConfigData(i,a),j(this.options.monitorProtection),e?(this.remove(),[4,this.create()]):[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},t.decode=function(i){var a=i.url,e=a===void 0?"":a,n=i.fillColor,o=n===void 0?"#000":n,l=i.compositeOperation,d=l===void 0?"color-burn":l,s=i.mode,c=s===void 0?"canvas":s,h=i.compositeTimes,v=h===void 0?3:h,u=i.onSuccess;if(e&&c==="canvas"){var m=new Image;m.src=e,m.addEventListener("load",function(){var p=m.width,f=m.height,w=C.createCanvas(p,f),g=w.getContext("2d");if(!g)throw new Error("get context error");g.drawImage(m,0,0,p,f),g.globalCompositeOperation=d,g.fillStyle=o;for(var _=0;_<v;_++)g.fillRect(0,0,p,f);var P=V(w);N(u)&&(u==null||u(P))})}},t})(F);const ut=X("watermark",()=>{const r=Y(),t=K(),i=U(),a=$({get(){return Object.assign({contentType:"multi-line-text",content:`Kpu-admin
                      当前用户：${t.account}`,fontColor:r.currentColorScheme==="light"?"#000":"#fff",globalAlpha:.1,width:200,height:200},i.value)},set(o){n(o)}}),e=new F(a.value);R(a,async()=>{r.settings.app.enableWatermark&&(await e.check(),e.changeOptions(a.value))},{deep:!0}),R(()=>r.settings.app.enableWatermark,o=>{o?e.create():e.destroy()},{immediate:!0}),R(()=>r.settings.app.colorScheme,async()=>{r.settings.app.enableWatermark&&(await e.check(),await J(),e.changeOptions(a.value))});function n(o={}){i.value=o}return{update:n}});export{ut as u};
