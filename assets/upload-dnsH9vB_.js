
/**
 * 由 admin 提供技术支持
 * Powered by admin
 * 代码仓库
 * Github https://github.com/Lmx1220/kpu-web
 */
    
import{d as R,l as h,f as q,o as m,w as v,e as p,i as s,p as T,V as X,b as k,h as S,bI as C,t as L,a5 as B,a6 as G,r as j,Y as M,F as Z,q as J,s as b,Z as O,n as A,j as _,a3 as F,G as K,aY as P,c2 as Q}from"./bootstrap-DTzpk8a9.js";import{_ as W}from"./index.vue_vue_type_script_setup_true_lang-DCSa_W1a.js";import{_ as x}from"./index.vue_vue_type_script_setup_true_lang-CvxDANHv.js";import{b as D}from"./route-block-B_A1xBdJ.js";import"./index-Ce4LrBVu.js";const ee={class:"slot"},te={key:0,class:"el-upload__tip"},se={style:{display:"inline-block"}},oe=R({name:"FileUpload",__name:"index",props:{action:{},headers:{},data:{},name:{default:"file"},size:{default:2},max:{default:3},files:{default:()=>[]},notip:{type:Boolean,default:!1},ext:{default:()=>["zip","rar"]},httpRequest:{}},emits:["onSuccess"],setup(y,{emit:w}){const c=y,E=w,l=i=>{const n=i.name.split(".").at(-1)??"",r=c.ext.includes(n),t=i.size/1024/1024<c.size;return r||C.error(`上传文件只支持 ${c.ext.join(" / ")} 格式！`),t||C.error(`上传文件大小不能超过 ${c.size}MB！`),r&&t},a=()=>{C.warning("文件上传超过限制")},U=(i,o,n)=>{E("onSuccess",i,o,n)},I=i=>{(n=>new Promise(r=>{const t=new XMLHttpRequest;t.open("GET",n,!0),t.responseType="blob",t.onload=()=>{t.status===200&&r(t.response)},t.send()}))(i.url).then(n=>{const r=document.createElement("a"),t=window.URL.createObjectURL(n),e=new MouseEvent("click");r.target="_blank",r.download=i.name,r.href=t,r.dispatchEvent(e)})};return(i,o)=>{const n=T,r=h("ElAlert"),t=h("ElUpload");return m(),q(t,{headers:i.headers,action:i.action,data:i.data,name:i.name,"before-upload":l,"on-exceed":a,"on-success":U,"on-preview":I,"http-request":i.httpRequest,"file-list":i.files,limit:i.max,drag:""},{tip:v(()=>[i.notip?S("",!0):(m(),k("div",te,[p("div",se,[s(r,{title:`上传文件支持 ${i.ext.join(" / ")} 格式，单个文件大小不超过 ${i.size}MB，且文件数量不超过 ${i.max} 个`,type:"info","show-icon":"",closable:!1},null,8,["title"])])]))]),default:v(()=>[p("div",ee,[s(n,{name:"i-ep:upload-filled",class:"el-icon--upload"}),o[0]||(o[0]=p("div",{class:"el-upload__text"},[X(" 将文件拖到此处，或"),p("em",null,"点击上传")],-1))])]),_:1},8,["headers","action","data","name","http-request","file-list","limit"])}}}),ae=L(oe,[["__scopeId","data-v-dcbfe806"]]),le={class:"upload-container"},ie={class:"mask"},ne={class:"actions"},pe=["onClick"],ce=["onClick"],re=["onClick"],ue=["onClick"],de={key:0,class:"el-upload__tip"},me={style:{display:"inline-block"}},he=R({name:"ImagesUpload",__name:"index",props:B({action:{},headers:{},data:{},name:{default:"file"},size:{default:2},max:{default:3},width:{default:150},height:{default:150},placeholder:{default:""},notip:{type:Boolean,default:!1},ext:{default:()=>["jpg","png","gif","bmp"]},httpRequest:{}},{modelValue:{default:[]},modelModifiers:{}}),emits:B(["onSuccess"],["update:modelValue"]),setup(y,{emit:w}){const c=y,E=w,l=G(y,"modelValue"),a=j({dialogImageIndex:0,imageViewerVisible:!1,progress:{preview:"",percent:0}});function U(e){a.value.dialogImageIndex=e,a.value.imageViewerVisible=!0}function I(){a.value.imageViewerVisible=!1}function i(e){l.value.splice(e,1)}function o(e,f){f==="left"&&e!==0&&(l.value[e]=l.value.splice(e-1,1,l.value[e])[0]),f==="right"&&e!==l.value.length-1&&(l.value[e]=l.value.splice(e+1,1,l.value[e])[0])}const n=e=>{const d=e.name.split(".").at(-1)??"",u=c.ext.includes(d),$=e.size/1024/1024<c.size;return u||C.error(`上传图片只支持 ${c.ext.join(" / ")} 格式！`),$||C.error(`上传图片大小不能超过 ${c.size}MB！`),u&&$&&(a.value.progress.preview=URL.createObjectURL(e)),u&&$},r=e=>{a.value.progress.percent=~~e.percent},t=e=>{a.value.progress.preview="",a.value.progress.percent=0,E("onSuccess",e)};return(e,f)=>{const d=h("ElImage"),u=T,$=h("ElProgress"),g=h("ElUpload"),z=h("ElAlert"),H=h("ElImageViewer");return m(),k("div",le,[(m(!0),k(Z,null,J(l.value,(Y,V)=>(m(),k("div",{key:V,class:"images"},[V<e.max?(m(),q(d,{key:0,src:Y,style:b(`width:${e.width}px;height:${e.height}px;`),fit:"cover"},null,8,["src","style"])):S("",!0),p("div",ie,[p("div",ne,[p("span",{onClick:N=>U(V)},[s(u,{name:"i-ep:zoom-in",class:"icon"})],8,pe),p("span",{onClick:N=>i(V)},[s(u,{name:"i-ep:delete",class:"icon"})],8,ce),M(p("span",{class:A({disabled:V===0}),onClick:N=>o(V,"left")},[s(u,{name:"i-ep:back",class:"icon"})],10,re),[[O,l.value.length>1]]),M(p("span",{class:A({disabled:V===l.value.length-1}),onClick:N=>o(V,"right")},[s(u,{name:"i-ep:right",class:"icon"})],10,ue),[[O,l.value.length>1]])])])]))),128)),M(s(g,{"show-file-list":!1,headers:e.headers,action:e.action,data:e.data,name:e.name,"before-upload":n,"on-progress":r,"on-success":t,"http-request":e.httpRequest,drag:"",class:"images-upload"},{default:v(()=>[p("div",{class:"image-slot",style:b(`width:${e.width}px;height:${e.height}px;`)},[s(u,{name:"i-ep:plus",class:"icon"})],4),M(p("div",{class:"progress",style:b(`width:${e.width}px;height:${e.height}px;`)},[s(d,{src:_(a).progress.preview,style:b(`width:${e.width}px;height:${e.height}px;`),fit:"fill"},null,8,["src","style"]),s($,{type:"circle",width:Math.min(e.width,e.height)*.8,percentage:_(a).progress.percent},null,8,["width","percentage"])],4),[[O,_(a).progress.percent]])]),_:1},8,["headers","action","data","name","http-request"]),[[O,l.value.length<e.max]]),e.notip?S("",!0):(m(),k("div",de,[p("div",me,[s(z,{title:`上传图片支持 ${e.ext.join(" / ")} 格式，单张图片大小不超过 ${e.size}MB，建议图片尺寸为 ${e.width}*${e.height}，且图片数量不超过 ${e.max} 张`,type:"info","show-icon":"",closable:!1},null,8,["title"])])])),_(a).imageViewerVisible?(m(),q(H,{key:1,"url-list":l.value,"initial-index":_(a).dialogImageIndex,teleported:"",onClose:I},null,8,["url-list","initial-index"])):S("",!0)])}}}),fe=L(he,[["__scopeId","data-v-64ffe7fc"]]),ge={class:"upload-container"},ve={key:1,class:"image"},_e={class:"mask"},we={class:"actions"},$e={key:0,class:"el-upload__tip"},be={style:{display:"inline-block"}},ke=R({name:"ImageUpload",__name:"index",props:B({action:{},headers:{},data:{},name:{default:"file"},size:{default:2},width:{default:150},height:{default:150},placeholder:{default:""},notip:{type:Boolean,default:!1},ext:{default:()=>["jpg","png","gif","bmp"]},httpRequest:{}},{modelValue:{default:""},modelModifiers:{}}),emits:B(["onSuccess"],["update:modelValue"]),setup(y,{emit:w}){const c=y,E=w,l=G(y,"modelValue"),a=j({imageViewerVisible:!1,progress:{preview:"",percent:0}});function U(){a.value.imageViewerVisible=!0}function I(){a.value.imageViewerVisible=!1}function i(){l.value=""}const o=t=>{const f=t.name.split(".").at(-1)??"",d=c.ext.includes(f),u=t.size/1024/1024<c.size;return d||C.error(`上传图片只支持 ${c.ext.join(" / ")} 格式！`),u||C.error(`上传图片大小不能超过 ${c.size}MB！`),d&&u&&(a.value.progress.preview=URL.createObjectURL(t)),d&&u},n=t=>{a.value.progress.percent=~~t.percent},r=t=>{a.value.progress.preview="",a.value.progress.percent=0,E("onSuccess",t)};return(t,e)=>{const f=T,d=h("ElImage"),u=h("ElProgress"),$=h("ElUpload"),g=h("ElAlert"),z=h("ElImageViewer");return m(),k("div",ge,[s($,{"show-file-list":!1,headers:t.headers,action:t.action,data:t.data,name:t.name,"before-upload":o,"on-progress":n,"on-success":r,"http-request":t.httpRequest,drag:"",class:"image-upload"},{default:v(()=>[l.value===""?(m(),q(d,{key:0,src:l.value===""?t.placeholder:l.value,style:b(`width:${t.width}px;height:${t.height}px;`),fit:"fill"},{error:v(()=>[p("div",{class:"image-slot",style:b(`width:${t.width}px;height:${t.height}px;`)},[s(f,{name:"i-ep:plus",class:"icon"})],4)]),_:1},8,["src","style"])):(m(),k("div",ve,[s(d,{src:l.value,style:b(`width:${t.width}px;height:${t.height}px;`),fit:"fill"},null,8,["src","style"]),p("div",_e,[p("div",we,[p("span",{onClick:F(U,["stop"])},[s(f,{name:"i-ep:zoom-in",class:"icon"})]),p("span",{onClick:F(i,["stop"])},[s(f,{name:"i-ep:delete",class:"icon"})])])])])),M(p("div",{class:"progress",style:b(`width:${t.width}px;height:${t.height}px;`)},[s(d,{src:_(a).progress.preview,style:b(`width:${t.width}px;height:${t.height}px;`),fit:"fill"},null,8,["src","style"]),s(u,{type:"circle",width:Math.min(t.width,t.height)*.8,percentage:_(a).progress.percent},null,8,["width","percentage"])],4),[[O,l.value===""&&_(a).progress.percent]])]),_:1},8,["headers","action","data","name","http-request"]),t.notip?S("",!0):(m(),k("div",$e,[p("div",be,[s(g,{title:`上传图片支持 ${t.ext.join(" / ")} 格式，且图片大小不超过 ${t.size}MB，建议图片尺寸为 ${t.width}*${t.height}`,type:"info","show-icon":"",closable:!1},null,8,["title"])])])),_(a).imageViewerVisible?(m(),q(z,{key:1,"url-list":[l.value],teleported:"",onClose:I},null,8,["url-list"])):S("",!0)])}}}),ye=L(ke,[["__scopeId","data-v-915b1326"]]),Ee=R({name:"ComponentExampleUpload",__name:"upload",setup(y){const w=j("https://picsum.photos/750/450"),c=j(["https://picsum.photos/400","https://picsum.photos/600","https://picsum.photos/500"]),E=j([{name:"kpu-admin.png",url:"https://lmx1220.github.io/kpu-web/assets/logo-BGVN89r2.png"}]);function l(o){o.error===""?w.value=o.data.path:P.warning(o.error)}function a(o){o.error===""?c.value.push(o.data.path):P.warning(o.error)}function U(o,n,r){o.error===""?E.value.push({name:n.name,url:o.error===""?o.data.path:""}):(r.pop(),P.warning(o.error))}const I=[{image:"https://picsum.photos/750/450",images:["https://picsum.photos/400","https://picsum.photos/600","https://picsum.photos/500"]},{image:"https://picsum.photos/750/450",images:["https://picsum.photos/400","https://picsum.photos/600","https://picsum.photos/500"]},{image:"https://picsum.photos/750/450",images:["https://picsum.photos/400","https://picsum.photos/600","https://picsum.photos/500"]},{image:"https://picsum.photos/750/450",images:["https://picsum.photos/400","https://picsum.photos/600","https://picsum.photos/500"]}];async function i(o){return await Q.upload(o.action,{file:o.file,...o.data})}return(o,n)=>{const r=x,t=ye,e=W,f=fe,d=ae,u=h("ElTableColumn"),$=h("ElTable");return m(),k("div",null,[s(r,{title:"上传"},{description:v(()=>n[2]||(n[2]=[p("div",{class:"space-y-2"},[p("p",null,"ImageUpload / ImagesUpload / FileUpload"),p("p",null," 由于线上演示环境开启了 Mock ，会导致上传功能报错，请在本地运行并查看演示 ")],-1)])),_:1}),s(e,{title:"单图上传"},{default:v(()=>[s(t,{modelValue:_(w),"onUpdate:modelValue":n[0]||(n[0]=g=>K(w)?w.value=g:null),action:"anyone/file/upload",data:{bizType:"DEF__APPLICATION__LOGO"},"http-request":i,name:"image",width:250,height:150,onOnSuccess:l},null,8,["modelValue"])]),_:1}),s(e,{title:"多图上传（默认最多3张）"},{default:v(()=>[s(f,{modelValue:_(c),"onUpdate:modelValue":n[1]||(n[1]=g=>K(c)?c.value=g:null),action:"https://console-mock.apipost.cn/app/mock/project/1f50f1da-5189-4282-d3c7-c133a514c5a8/upload/image",name:"image",onOnSuccess:a},null,8,["modelValue"])]),_:1}),s(e,{title:"文件上传（默认最多3个）"},{default:v(()=>[s(d,{files:_(E),action:"https://console-mock.apipost.cn/app/mock/project/1f50f1da-5189-4282-d3c7-c133a514c5a8/upload/file",onOnSuccess:U},null,8,["files"])]),_:1}),s(e,{title:"结合 el-table 使用"},{default:v(()=>[s($,{data:I,style:{width:"100%"}},{default:v(()=>[s(u,{type:"index",width:"50",fixed:"left"}),s(u,{label:"单张图片"},{default:v(({row:g})=>[s(t,{url:g.image,"onUpdate:url":z=>g.image=z,action:"https://console-mock.apipost.cn/app/mock/project/1f50f1da-5189-4282-d3c7-c133a514c5a8/upload/image",name:"image",width:250,height:150,onOnSuccess:l},null,8,["url","onUpdate:url"])]),_:1}),s(u,{label:"多张图片"},{default:v(({row:g})=>[s(f,{url:g.images,"onUpdate:url":z=>g.images=z,action:"https://console-mock.apipost.cn/app/mock/project/1f50f1da-5189-4282-d3c7-c133a514c5a8/upload/image",name:"image",onOnSuccess:a},null,8,["url","onUpdate:url"])]),_:1})]),_:1})]),_:1})])}}});typeof D=="function"&&D(Ee);export{Ee as default};
