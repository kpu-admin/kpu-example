
/**
 * 由 admin 提供技术支持
 * Powered by admin
 * 代码仓库
 * Github https://github.com/Lmx1220/kpu-web
 */
    
import{d as w,A as H,D as J,B as L,E as Q,C as W,c,r as O,z as k,f as b,o as g,w as B,y as D,i as T,j as l,O as A,P as q,al as X,H as Y,am as Z,J as j,an as ee,K as te,N as ae,R as K,S as U,a5 as N,a6 as le,a7 as oe,b as ne,F as se,q as ue}from"./bootstrap-DTzpk8a9.js";import{_ as re}from"./VisuallyHiddenInput-BWgIjf8G.js";import{u as de}from"./useArrowNavigation-B5rxJs06.js";const[ie,ce]=H("PinInputRoot"),pe=w({inheritAttrs:!1,__name:"PinInputRoot",props:{modelValue:{},defaultValue:{},placeholder:{default:""},mask:{type:Boolean},otp:{type:Boolean},type:{default:"text"},dir:{},disabled:{type:Boolean},id:{},asChild:{type:Boolean},as:{},name:{},required:{type:Boolean}},emits:["update:modelValue","complete"],setup(i,{emit:o}){const t=i,n=o,{mask:u,otp:r,placeholder:f,type:s,disabled:v,dir:y}=J(t),{forwardRef:_}=L(),M=Q(y),m=W(t,"modelValue",n,{defaultValue:t.defaultValue??[],passive:t.modelValue===void 0}),C=c(()=>Array.isArray(m.value)?[...m.value]:[]),x=O(new Set);function F(p){x.value.add(p)}const E=c(()=>C.value.filter(P=>!!P).length===x.value.size);return k(m,()=>{E.value&&n("complete",m.value)},{deep:!0}),ce({modelValue:m,currentModelValue:C,mask:u,otp:r,placeholder:f,type:s,dir:M,disabled:v,isCompleted:E,inputElements:x,onInputElementChange:F}),(p,P)=>(g(),b(l(q),A(p.$attrs,{ref:l(_),dir:l(M),"data-complete":E.value?"":void 0,"data-disabled":l(v)?"":void 0}),{default:B(()=>[D(p.$slots,"default",{modelValue:l(m)}),T(re,{id:p.id,as:"input",feature:"focusable",tabindex:"-1",value:C.value.join(""),name:p.name??"",disabled:l(v),required:p.required,onFocus:P[0]||(P[0]=R=>{var $,V;return(V=($=Array.from(x.value))==null?void 0:$[0])==null?void 0:V.focus()})},null,8,["id","value","name","disabled","required"])]),_:3},16,["dir","data-complete","data-disabled"]))}}),me=w({__name:"PinInputInput",props:{index:{},disabled:{type:Boolean},asChild:{type:Boolean},as:{default:"input"}},setup(i){const o=i,t=ie(),n=c(()=>Array.from(t.inputElements.value)),u=c(()=>t.currentModelValue.value[o.index]),r=c(()=>o.disabled||t.disabled.value),f=c(()=>t.otp.value),s=c(()=>t.type.value==="number"),v=c(()=>t.mask.value),{primitiveElement:y,currentElement:_}=X();function M(e){var h;const a=e.target;if((((h=e.data)==null?void 0:h.length)??0)>1){R(a.value);return}if(s.value&&!/^\d*$/.test(a.value)){a.value=a.value.replace(/\D/g,"");return}a.value=a.value.slice(-1),V(o.index,a.value);const d=n.value[o.index+1];d&&d.focus()}function m(){const e=_.value;te(()=>{e&&!e.value&&(e.placeholder=t.placeholder.value)})}function C(e){de(e,ee(),void 0,{itemsArray:n.value,focus:!0,loop:!1,arrowKeyOptions:"horizontal",dir:t.dir.value})}function x(e){if(e.preventDefault(),e.target.value)V(o.index,"");else{const h=n.value[o.index-1];h&&(h.focus(),V(o.index-1,""))}}function F(e){e.key==="Delete"&&(e.preventDefault(),V(o.index,""))}function E(e){const a=e.target;a.setSelectionRange(1,1),a.value||(a.placeholder="")}function p(e){m()}function P(e){e.preventDefault();const a=e.clipboardData;if(!a)return;const d=a.getData("text");R(d)}function R(e){var z;const a=[...t.currentModelValue.value],d=e.length>=n.value.length?0:o.index,h=Math.min(d+e.length,n.value.length);for(let I=d;I<h;I++){const G=n.value[I],S=e[I-d];s.value&&!/^\d*$/.test(S)||(a[I]=S,G.focus())}t.modelValue.value=a,(z=n.value[h])==null||z.focus()}function $(e){let a=e.length-1;for(;a>=0&&e[a]==="";)e.pop(),a--;return e}function V(e,a){const d=[...t.currentModelValue.value];d[e]=a,t.modelValue.value=$(d)}return k(u,()=>{u.value||m()}),Y(()=>{t.onInputElementChange(_.value)}),Z(()=>{var e;(e=t.inputElements)==null||e.value.delete(_.value)}),(e,a)=>(g(),b(l(q),{ref_key:"primitiveElement",ref:y,autocapitalize:"none",as:e.as,"as-child":e.asChild,autocomplete:f.value?"one-time-code":"false",type:v.value?"password":"text",inputmode:s.value?"numeric":"text",pattern:s.value?"[0-9]*":void 0,placeholder:l(t).placeholder.value,value:u.value,disabled:r.value,"data-disabled":r.value?"":void 0,"data-complete":l(t).isCompleted.value?"":void 0,"aria-label":`pin input ${e.index+1} of ${n.value.length}`,onInput:a[0]||(a[0]=d=>M(d)),onKeydown:[j(C,["left","right","up","down","home","end"]),j(x,["backspace"]),j(F,["delete"])],onFocus:E,onBlur:p,onPaste:P},{default:B(()=>[D(e.$slots,"default")]),_:3},8,["as","as-child","autocomplete","type","inputmode","pattern","placeholder","value","disabled","data-disabled","data-complete","aria-label"]))}}),fe=w({__name:"PinInput",props:{modelValue:{default:()=>[]},defaultValue:{},placeholder:{},mask:{type:Boolean},otp:{type:Boolean},type:{},dir:{},disabled:{type:Boolean},id:{},asChild:{type:Boolean},as:{},name:{},required:{type:Boolean},class:{}},emits:["update:modelValue","complete"],setup(i,{emit:o}){const t=i,n=o,u=c(()=>{const{class:f,...s}=t;return s}),r=ae(u,n);return(f,s)=>(g(),b(l(pe),A(l(r),{class:l(K)("flex gap-2 items-center",t.class)}),{default:B(()=>[D(f.$slots,"default")]),_:3},16,["class"]))}}),ve=w({__name:"PinInputGroup",props:{asChild:{type:Boolean},as:{},class:{}},setup(i){const o=i,t=c(()=>{const{class:u,...r}=o;return r}),n=U(t);return(u,r)=>(g(),b(l(q),A(l(n),{class:l(K)("flex items-center",o.class)}),{default:B(()=>[D(u.$slots,"default")]),_:3},16,["class"]))}}),he=w({__name:"PinInputInput",props:{index:{},disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(i){const o=i,t=c(()=>{const{class:u,...r}=o;return r}),n=U(t);return(u,r)=>(g(),b(l(me),A(l(n),{class:l(K)("relative text-center focus:outline-none focus:ring-2 focus:ring-ring focus:relative focus:z-10 flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",o.class)}),null,16,["class"]))}}),Ve=w({name:"KPinInput",__name:"index",props:N({length:{default:6}},{modelValue:{},modelModifiers:{}}),emits:N(["complete"],["update:modelValue"]),setup(i,{emit:o}){const t=o,n=le(i,"modelValue"),u=O([]);k(n,s=>{u.value=(s==null?void 0:s.split(""))??[]}),k(u,s=>{n.value=s.join("")});function r(s){n.value=s.join(""),t("complete")}const f=oe();return(s,v)=>(g(),b(l(fe),{id:l(f),"model-value":l(u),placeholder:"○",otp:"",type:"number",onComplete:r,"onUpdate:modelValue":v[0]||(v[0]=y=>u.value=y.filter(Boolean))},{default:B(()=>[T(l(ve),null,{default:B(()=>[(g(!0),ne(se,null,ue(s.length,(y,_)=>(g(),b(l(he),{key:y,index:_},null,8,["index"]))),128))]),_:1})]),_:1},8,["id","model-value"]))}});export{Ve as _};
